const fileInput = document.getElementById('fileInput');
const uploadBox = document.getElementById('uploadBox');
const uploadStatus = document.getElementById('uploadStatus');
const resultArea = document.getElementById('resultArea');
const ocrBtn = document.getElementById('ocrBtn');
const summaryBtn = document.getElementById('summaryBtn');
const quizBtn = document.getElementById('quizBtn');
const preview = document.getElementById('preview');
const resizer = document.getElementById('resizer');
const sidebar = document.getElementById('sidebar');
const answerSection = document.getElementById('answerSection');

alert("welcome-----------0")

let uploadedText = ''; // ì—…ë¡œë“œ ì—¬ë¶€ í™•ì¸ìš©
let isFullScreen = false;

// ê¸°ëŠ¥ë³„ ê²°ê³¼ ë³€ìˆ˜
let ocrResult = '';
let summaryResult = '';
let quizQuestion = '';

// ë²„íŠ¼ í™œì„±í™” í‘œì‹œ
const buttons = [ocrBtn, summaryBtn, quizBtn];
buttons.forEach(btn => {
  btn.addEventListener('click', () => {
    if (!uploadedText) return;
    buttons.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
  });
});

// ì´ë¯¸ì§€ ë°•ìŠ¤ í´ë¦­ â†’ ì—…ë¡œë“œ ë˜ëŠ” ì „ì²´í™”ë©´
uploadBox.addEventListener('click', () => {
  if (!preview.src || preview.style.display === 'none') {
    fileInput.click();
  } else {
    isFullScreen = !isFullScreen;
    uploadBox.classList.toggle('fullscreen', isFullScreen);
    sidebar.classList.toggle('fullscreen-hide', isFullScreen);
  }
});

uploadStatus.addEventListener('click', () => {
  fileInput.click();
});

// ì´ë¯¸ì§€ íŒŒì¼ ì—…ë¡œë“œ ì‹œ
fileInput.addEventListener('change', () => {
alert("welcome-----------0")
  const file = fileInput.files[0];
  if (!file) return;

  uploadStatus.style.display = 'block';
  fileInput.value = '';

  const reader = new FileReader();
  reader.onload = () => {
    preview.src = reader.result;
    preview.style.display = 'block';
    uploadBox.classList.add('hide-text');
    document.getElementById('clickGuide').style.display = 'block';
  
    // ê¸°ëŠ¥ë³„ ê²°ê³¼ í…ìŠ¤íŠ¸ ì„¤ì •
    ocrResult = `ğŸ“„ [OCR ê²°ê³¼] "${file.name}" íŒŒì¼ì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì¸ì‹í–ˆìŠµë‹ˆë‹¤.`;
    summaryResult = `ğŸ“ [ìš”ì•½ ê²°ê³¼] "${file.name}"ì—ì„œ ì¸ì‹í•œ í…ìŠ¤íŠ¸ì˜ í•µì‹¬ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤: ...`;
    quizQuestion = `ğŸ§  [ë¬¸ì œ] "${file.name}" ì´ë¯¸ì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±ëœ ì§ˆë¬¸ì…ë‹ˆë‹¤. ì´ ì´ë¯¸ì§€ì˜ ëª©ì ì€ ë¬´ì—‡ì¸ê°€ìš”?`;
  
    uploadedText = 'uploaded';
  
    // OCR ê²°ê³¼ ìë™ í‘œì‹œ
    resultArea.innerHTML = `<p>${ocrResult}</p>`;
    answerSection.innerHTML = '';
  
    // OCR ë²„íŠ¼ íŒŒë€ìƒ‰(active) ì„¤ì •
    ocrBtn.classList.add('active');
    buttons.forEach(b => {
      if (b !== ocrBtn) b.classList.remove('active');
    });
  };
  reader.readAsDataURL(file);
});

// OCR ë²„íŠ¼
ocrBtn.addEventListener('click', () => {
  if (!uploadedText) return alert('ë¨¼ì € ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”.');
  resultArea.innerHTML = `<p>${ocrResult}</p>`;
  answerSection.innerHTML = '';
});

// ìš”ì•½ ë²„íŠ¼
summaryBtn.addEventListener('click', () => {
  if (!uploadedText) return alert('ë¨¼ì € ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”.');
  resultArea.innerHTML = `<p>${summaryResult}</p>`;
  answerSection.innerHTML = '';
});

// ë¬¸ì œ ë²„íŠ¼
quizBtn.addEventListener('click', () => {
  if (!uploadedText) return alert('ë¨¼ì € ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”.');

  resultArea.innerHTML = `<p>${quizQuestion}</p>`;
  answerSection.innerHTML = '';

  answerSection.innerHTML = `
    <div class="answer-row" style="display: flex; gap: 0.5rem; align-items: center; margin-top: 1.5rem; margin-bottom: 1rem;">
      <input type="text" id="userAnswer" placeholder="ì˜ˆ: ì´ ì´ë¯¸ì§€ëŠ” ~~ ì˜ë¯¸ë¥¼ ê°€ì§‘ë‹ˆë‹¤"
        style="flex: 1; padding: 0.75rem 1rem;
               border: 1px solid #cbd5e1; border-radius: 8px; font-size: 0.95rem;">
      <button id="submitAnswer"
        style="padding: 0.6rem 1.5rem; background-color: #38bdf8; color: white;
               border: none; border-radius: 8px; cursor: pointer;
               font-weight: 500; font-size: 0.95rem;">ì œì¶œ</button>
    </div>
    <div id="feedback" style="margin-top: 1rem;"></div>
  `;

  // ë‹µì•ˆ í‚¤ì›Œë“œ: í•´ë‹¹ ë‹¨ì–´ê°€ í¬í•¨ë˜ì–´ì•¼ ì •ë‹µìœ¼ë¡œ ì¸ì •
  const correctKeywords = ["ì´ë¯¸ì§€", "ì‚¬ì§„", "ì‚¬ì§„íŒŒì¼", "ì—…ë¡œë“œ"];

  const submitHandler = () => {
    const userAnswer = document.getElementById('userAnswer').value.trim();
    const feedback = document.getElementById('feedback');

    if (!userAnswer) {
      feedback.innerHTML = `<span style="color: red;">âš ï¸ ë‹µì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>`;
    } else {
      const isCorrect = correctKeywords.some(keyword => userAnswer.includes(keyword));
      feedback.innerHTML = isCorrect
        ? `<span style="color: green;">âœ… ì •ë‹µì…ë‹ˆë‹¤! ì˜í•˜ì…¨ì–´ìš”.</span>`
        : `<span style="color: orange;">ğŸ¤” ì•„ì‰½ë„¤ìš”. "ì´ë¯¸ì§€" ê´€ë ¨ í‘œí˜„ì„ í¬í•¨í•´ë³´ì„¸ìš”.<br>
             <span style="font-size: 0.85rem;">ì˜ˆì‹œ ì •ë‹µ: "ì—…ë¡œë“œëœ ì´ë¯¸ì§€ì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤."</span></span>`;
      document.getElementById('submitAnswer').disabled = true;
    }
  };

  document.getElementById('submitAnswer').addEventListener('click', submitHandler);
  document.getElementById('userAnswer').addEventListener('keydown', (e) => {
    if (e.key === 'Enter') submitHandler();
  });
});

// ì‚¬ì´ë“œë°” ë¦¬ì‚¬ì´ì € ê¸°ëŠ¥
let isResizing = false;

resizer.addEventListener('mousedown', () => {
  isResizing = true;
  document.body.style.cursor = 'col-resize';
});

document.addEventListener('mousemove', (e) => {
  if (!isResizing) return;
  const newWidth = Math.max(200, e.clientX);
  sidebar.style.width = `${newWidth}px`;
});

document.addEventListener('mouseup', () => {
  isResizing = false;
  document.body.style.cursor = 'default';
});
